{{define "sboms"}}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h3>
        <i class="bi bi-file-earmark-text text-primary"></i>
        SBOM 목록
    </h3>
    <button class="btn btn-primary" onclick="showNewScanModal()">
        <i class="bi bi-plus-circle"></i>
        새 스캔 실행
    </button>
</div>

<div class="card">
    <div class="card-header">
        <div class="row align-items-center">
            <div class="col-md-5">
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="bi bi-search"></i>
                    </span>
                    <input type="text" class="form-control" id="repoSearchInput" 
                           placeholder="저장소 이름으로 검색..." 
                           onkeyup="filterSBOMs()">
                    <button class="btn btn-outline-secondary" type="button" onclick="clearSearch()">
                        <i class="bi bi-x-circle"></i>
                    </button>
                </div>
            </div>
            <div class="col-md-5">
                <div class="btn-group" role="group">
                    <button class="btn btn-outline-primary btn-sm" onclick="filterByType('all')" id="filterAll">
                        전체 (<span id="countAll">0</span>)
                    </button>
                    <button class="btn btn-outline-success btn-sm" onclick="filterByType('single')" id="filterSingle">
                        단일 모듈 (<span id="countSingle">0</span>)
                    </button>
                    <button class="btn btn-outline-info btn-sm" onclick="filterByType('multi')" id="filterMulti">
                        멀티 모듈 (<span id="countMulti">0</span>)
                    </button>
                </div>
            </div>
            <div class="col-md-2 text-end">
                <div class="d-flex align-items-center gap-1 justify-content-end">
                    <label for="sbomPageSize" class="form-label mb-0 small">크기:</label>
                    <select class="form-select form-select-sm" id="sbomPageSize" style="width: auto;" onchange="changeSBOMPageSize()">
                        <option value="10">10</option>
                        <option value="20" selected>20</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover" id="sbomsTable">
                <thead>
                    <tr>
                        <th>저장소</th>
                        <th>모듈 경로</th>
                        <th>스캔 날짜</th>
                        <th>컴포넌트 수</th>
                        <th>취약점</th>
                        <th>위험도</th>
                        <th>액션</th>
                    </tr>
                </thead>
                <tbody id="sbomsTableBody">
                    {{range .SBOMs}}
                    <tr data-repo="{{.RepoName}}" data-module="{{.ModulePath}}" class="sbom-row">
                        <td>
                            <div class="d-flex align-items-center">
                                <i class="bi bi-git text-muted me-2"></i>
                                <div>
                                    <strong>{{.RepoName}}</strong>
                                    <span class="repo-modules-count badge bg-secondary ms-2" 
                                          data-repo="{{.RepoName}}" style="display: none;"></span>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="d-flex align-items-center">
                                <i class="bi bi-folder text-warning me-2"></i>
                                <code class="text-primary">{{if eq .ModulePath "root"}}/ (루트){{else}}{{.ModulePath}}{{end}}</code>
                            </div>
                        </td>
                        <td>
                            <small class="text-muted">{{.ScanDate.Format "2006-01-02 15:04"}}</small>
                        </td>
                        <td>
                            <span class="badge bg-info">{{.ComponentCount}}</span>
                        </td>
                        <td>
                            <div class="vulnerability-info" data-sbom-id="{{.ID}}">
                                <div class="spinner-border spinner-border-sm text-muted" role="status">
                                    <span class="visually-hidden">로딩 중...</span>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="risk-level" data-sbom-id="{{.ID}}">
                                <span class="badge bg-light text-muted">계산 중...</span>
                            </div>
                        </td>
                        <td>
                            <div class="btn-group" role="group">
                                <a href="/sboms/{{.ID}}" class="btn btn-sm btn-outline-primary" 
                                   title="{{.RepoName}}/{{.ModulePath}} 상세보기">
                                    <i class="bi bi-eye"></i>
                                    상세보기
                                </a>
                                <button class="btn btn-sm btn-outline-success" onclick="rescanSBOM({{.ID}})"
                                        title="{{.RepoName}}/{{.ModulePath}} 재스캔">
                                    <i class="bi bi-arrow-clockwise"></i>
                                    재스캔
                                </button>
                            </div>
                        </td>
                    </tr>
                    {{else}}
                    <tr id="noDataRow">
                        <td colspan="7" class="text-center text-muted py-4">
                            <i class="bi bi-inbox display-4 d-block mb-3"></i>
                            아직 스캔된 SBOM이 없습니다.
                            <br><br>
                            <button class="btn btn-primary mt-2" onclick="showNewScanModal()">
                                <i class="bi bi-plus-circle"></i>
                                첫 번째 스캔 시작하기
                            </button>
                        </td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
        </div>
        
        <!-- 페이지네이션 -->
        <nav aria-label="SBOM 페이지네이션" class="mt-3">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <small class="text-muted" id="sbomPageInfo">페이지 정보</small>
                </div>
                <ul class="pagination pagination-sm mb-0" id="sbomPagination">
                    <!-- 페이지네이션 버튼들이 여기에 생성됩니다 -->
                </ul>
            </div>
        </nav>
    </div>
</div>

<!-- 새 스캔 모달 -->
<div class="modal fade" id="newScanModal" tabindex="-1" aria-labelledby="newScanModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="newScanModalLabel">
                    <i class="bi bi-plus-circle"></i>
                    새 스캔 실행
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="newScanForm">
                    <div class="mb-3">
                        <label for="repoPath" class="form-label">저장소 경로</label>
                        <input type="text" class="form-control" id="repoPath" placeholder="/path/to/repository" required>
                        <div class="form-text">스캔할 저장소의 절대 경로를 입력하세요.</div>
                    </div>
                    <div class="mb-3">
                        <label for="repoName" class="form-label">저장소 이름</label>
                        <input type="text" class="form-control" id="repoName" placeholder="my-project" required>
                        <div class="form-text">저장소 식별을 위한 이름을 입력하세요.</div>
                    </div>
                    <div class="mb-3">
                        <label for="modulePath" class="form-label">모듈 경로 (선택사항)</label>
                        <input type="text" class="form-control" id="modulePath" placeholder="github.com/user/repo">
                        <div class="form-text">Go 모듈 경로가 있는 경우 입력하세요.</div>
                    </div>
                    <div class="mb-3">
                        <label for="scanType" class="form-label">스캔 타입</label>
                        <select class="form-select" id="scanType" required>
                            <option value="syft">Syft (SBOM 생성)</option>
                            <option value="grype">Grype (취약점 스캔)</option>
                            <option value="both">Both (SBOM + 취약점)</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                <button type="button" class="btn btn-primary" onclick="startNewScan()">
                    <i class="bi bi-play-circle"></i>
                    스캔 시작
                </button>
            </div>
        </div>
    </div>
</div>

<!-- 스캔 진행 상황 모달 -->
<div class="modal fade" id="scanProgressModal" tabindex="-1" aria-labelledby="scanProgressModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="scanProgressModalLabel">
                    <i class="bi bi-hourglass-split"></i>
                    스캔 진행 중
                </h5>
            </div>
            <div class="modal-body text-center">
                <div class="spinner-border text-primary mb-3" role="status">
                    <span class="visually-hidden">스캔 중...</span>
                </div>
                <p id="scanProgressText">스캔을 시작하고 있습니다...</p>
                <div class="progress mb-3">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" 
                         id="scanProgressBar" style="width: 0%"></div>
                </div>
                <small class="text-muted" id="scanStatusText">잠시만 기다려주세요.</small>
            </div>
        </div>
    </div>
</div>

<script>
// 새 스캔 모달 표시
function showNewScanModal() {
    const modal = new bootstrap.Modal(document.getElementById('newScanModal'));
    modal.show();
}

// 새 스캔 시작
async function startNewScan() {
    const form = document.getElementById('newScanForm');
    if (!form.checkValidity()) {
        form.reportValidity();
        return;
    }

    const formData = {
        repo_path: document.getElementById('repoPath').value,
        repo_name: document.getElementById('repoName').value,
        module_path: document.getElementById('modulePath').value,
        scan_type: document.getElementById('scanType').value
    };

    // 새 스캔 모달 닫기
    bootstrap.Modal.getInstance(document.getElementById('newScanModal')).hide();
    
    // 진행 상황 모달 표시
    const progressModal = new bootstrap.Modal(document.getElementById('scanProgressModal'));
    progressModal.show();

    try {
        // 스캔 시작 API 호출
        const response = await fetch('/api/v1/scan/start', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        });

        if (!response.ok) {
            throw new Error('스캔 시작에 실패했습니다.');
        }

        const result = await response.json();
        
        // 스캔 진행 상황 모니터링
        monitorScanProgress(result.scan_id);
        
    } catch (error) {
        console.error('Scan error:', error);
        progressModal.hide();
        alert('스캔 시작 중 오류가 발생했습니다: ' + error.message);
    }
}

// 스캔 진행 상황 모니터링
async function monitorScanProgress(scanId) {
    const progressText = document.getElementById('scanProgressText');
    const progressBar = document.getElementById('scanProgressBar');
    const statusText = document.getElementById('scanStatusText');
    
    let progress = 0;
    const interval = setInterval(async () => {
        try {
            const response = await fetch(`/api/v1/scan/status/${scanId}`);
            if (response.ok) {
                const status = await response.json();
                
                progressText.textContent = status.message || '스캔 진행 중...';
                statusText.textContent = status.details || '';
                
                progress += 10;
                if (progress > 90) progress = 90;
                progressBar.style.width = progress + '%';
                
                if (status.status === 'completed') {
                    clearInterval(interval);
                    progressBar.style.width = '100%';
                    progressText.textContent = '스캔이 완료되었습니다!';
                    statusText.textContent = '페이지를 새로고침합니다...';
                    
                    setTimeout(() => {
                        bootstrap.Modal.getInstance(document.getElementById('scanProgressModal')).hide();
                        location.reload();
                    }, 2000);
                } else if (status.status === 'failed') {
                    clearInterval(interval);
                    progressText.textContent = '스캔이 실패했습니다.';
                    statusText.textContent = status.error || '알 수 없는 오류가 발생했습니다.';
                    
                    setTimeout(() => {
                        bootstrap.Modal.getInstance(document.getElementById('scanProgressModal')).hide();
                    }, 3000);
                }
            }
        } catch (error) {
            console.error('Progress monitoring error:', error);
        }
    }, 2000);
    
    // 5분 후 타임아웃
    setTimeout(() => {
        clearInterval(interval);
        if (bootstrap.Modal.getInstance(document.getElementById('scanProgressModal'))) {
            progressText.textContent = '스캔 시간이 초과되었습니다.';
            statusText.textContent = '수동으로 확인해주세요.';
        }
    }, 300000);
}

// SBOM 재스캔
async function rescanSBOM(sbomId) {
    if (!confirm('이 SBOM을 다시 스캔하시겠습니까?')) {
        return;
    }

    try {
        const response = await fetch(`/api/v1/sboms/${sbomId}/rescan`, {
            method: 'POST'
        });

        if (!response.ok) {
            throw new Error('재스캔 시작에 실패했습니다.');
        }

        const result = await response.json();
        
        // 진행 상황 모달 표시
        const progressModal = new bootstrap.Modal(document.getElementById('scanProgressModal'));
        progressModal.show();
        
        // 스캔 진행 상황 모니터링
        monitorScanProgress(result.scan_id);
        
    } catch (error) {
        console.error('Rescan error:', error);
        alert('재스캔 시작 중 오류가 발생했습니다: ' + error.message);
    }
}

// 전역 변수
let allSBOMs = [];
let filteredSBOMs = [];
let currentFilter = 'all';
let currentPage = 1;
let pageSize = 20;

// 페이지 로드 시 초기화
document.addEventListener('DOMContentLoaded', function() {
    console.log('SBOM 페이지가 로드되었습니다.');
    initializeSBOMsPage();
});

// SBOM 페이지 초기화
function initializeSBOMsPage() {
    loadSBOMData();
    updateModuleCounts();
    loadVulnerabilityData();
}

// SBOM 데이터 로드
function loadSBOMData() {
    const rows = document.querySelectorAll('.sbom-row');
    allSBOMs = Array.from(rows).map(row => ({
        element: row,
        repo: row.dataset.repo,
        module: row.dataset.module,
        text: (row.dataset.repo + ' ' + row.dataset.module).toLowerCase()
    }));
    filteredSBOMs = [...allSBOMs];
    updateFilterCounts();
    applySBOMPagination();
}

// 저장소별 모듈 수 업데이트
function updateModuleCounts() {
    const repoCounts = {};
    allSBOMs.forEach(sbom => {
        repoCounts[sbom.repo] = (repoCounts[sbom.repo] || 0) + 1;
    });
    
    Object.entries(repoCounts).forEach(([repo, count]) => {
        if (count > 1) {
            const badges = document.querySelectorAll(`[data-repo="${repo}"].repo-modules-count`);
            badges.forEach(badge => {
                badge.textContent = `${count}개 모듈`;
                badge.style.display = 'inline';
            });
        }
    });
}

// 취약점 데이터 로드
async function loadVulnerabilityData() {
    const vulnerabilityInfos = document.querySelectorAll('.vulnerability-info');
    const riskLevels = document.querySelectorAll('.risk-level');
    
    for (const info of vulnerabilityInfos) {
        const sbomId = info.dataset.sbomId;
        try {
            const response = await fetch(`/api/v1/sboms/${sbomId}/vulnerabilities`);
            if (response.ok) {
                const vulnerabilities = await response.json();
                updateVulnerabilityDisplay(info, vulnerabilities);
                updateRiskLevel(document.querySelector(`[data-sbom-id="${sbomId}"].risk-level`), vulnerabilities);
            } else {
                info.innerHTML = '<span class="text-muted">-</span>';
            }
        } catch (error) {
            console.error('취약점 데이터 로드 실패:', error);
            info.innerHTML = '<span class="text-danger">오류</span>';
        }
    }
}

// 취약점 표시 업데이트
function updateVulnerabilityDisplay(container, vulnerabilities) {
    if (!vulnerabilities || vulnerabilities.length === 0) {
        container.innerHTML = '<span class="badge bg-success">0</span>';
        return;
    }
    
    const severityCounts = {
        Critical: 0,
        High: 0,
        Medium: 0,
        Low: 0
    };
    
    vulnerabilities.forEach(vuln => {
        if (severityCounts.hasOwnProperty(vuln.severity)) {
            severityCounts[vuln.severity]++;
        }
    });
    
    const total = vulnerabilities.length;
    let html = `<div class="d-flex align-items-center gap-1">`;
    html += `<span class="badge bg-secondary">${total}</span>`;
    
    if (severityCounts.Critical > 0) {
        html += `<span class="badge bg-danger" title="Critical">${severityCounts.Critical}C</span>`;
    }
    if (severityCounts.High > 0) {
        html += `<span class="badge bg-warning" title="High">${severityCounts.High}H</span>`;
    }
    if (severityCounts.Medium > 0) {
        html += `<span class="badge bg-info" title="Medium">${severityCounts.Medium}M</span>`;
    }
    if (severityCounts.Low > 0) {
        html += `<span class="badge bg-light text-dark" title="Low">${severityCounts.Low}L</span>`;
    }
    
    html += '</div>';
    container.innerHTML = html;
}

// 위험도 레벨 업데이트
function updateRiskLevel(container, vulnerabilities) {
    if (!container) return;
    
    if (!vulnerabilities || vulnerabilities.length === 0) {
        container.innerHTML = '<span class="badge bg-success">안전</span>';
        return;
    }
    
    const severityCounts = {
        Critical: 0,
        High: 0,
        Medium: 0,
        Low: 0
    };
    
    vulnerabilities.forEach(vuln => {
        if (severityCounts.hasOwnProperty(vuln.severity)) {
            severityCounts[vuln.severity]++;
        }
    });
    
    let riskLevel = '낮음';
    let badgeClass = 'bg-success';
    
    if (severityCounts.Critical > 0) {
        riskLevel = '매우 높음';
        badgeClass = 'bg-danger';
    } else if (severityCounts.High > 5) {
        riskLevel = '높음';
        badgeClass = 'bg-warning';
    } else if (severityCounts.High > 0 || severityCounts.Medium > 10) {
        riskLevel = '보통';
        badgeClass = 'bg-info';
    }
    
    container.innerHTML = `<span class="badge ${badgeClass}">${riskLevel}</span>`;
}

// SBOM 검색 및 필터링
function filterSBOMs() {
    const searchTerm = document.getElementById('repoSearchInput').value.toLowerCase();
    
    filteredSBOMs = allSBOMs.filter(sbom => {
        const matchesSearch = sbom.text.includes(searchTerm);
        const matchesFilter = currentFilter === 'all' || 
                            (currentFilter === 'single' && isRepoSingleModule(sbom.repo)) ||
                            (currentFilter === 'multi' && !isRepoSingleModule(sbom.repo));
        
        return matchesSearch && matchesFilter;
    });
    
    currentPage = 1; // 필터링 후 첫 페이지로 이동
    applySBOMPagination();
    
    // 검색 결과가 없으면 메시지 표시
    updateNoResultsMessage(filteredSBOMs.length, searchTerm);
}

// 타입별 필터링
function filterByType(type) {
    currentFilter = type;
    
    // 버튼 활성화 상태 업데이트
    document.querySelectorAll('[id^="filter"]').forEach(btn => {
        btn.classList.remove('active');
    });
    document.getElementById(`filter${type.charAt(0).toUpperCase() + type.slice(1)}`).classList.add('active');
    
    filterSBOMs();
}

// 검색 초기화
function clearSearch() {
    document.getElementById('repoSearchInput').value = '';
    filterSBOMs();
}

// 저장소가 단일 모듈인지 확인
function isRepoSingleModule(repoName) {
    return allSBOMs.filter(sbom => sbom.repo === repoName).length === 1;
}

// 필터 카운트 업데이트
function updateFilterCounts() {
    const repoGroups = {};
    allSBOMs.forEach(sbom => {
        if (!repoGroups[sbom.repo]) {
            repoGroups[sbom.repo] = [];
        }
        repoGroups[sbom.repo].push(sbom);
    });
    
    const totalCount = allSBOMs.length;
    const singleModuleRepos = Object.values(repoGroups).filter(modules => modules.length === 1);
    const multiModuleRepos = Object.values(repoGroups).filter(modules => modules.length > 1);
    
    const singleCount = singleModuleRepos.length;
    const multiCount = multiModuleRepos.reduce((sum, modules) => sum + modules.length, 0);
    
    document.getElementById('countAll').textContent = totalCount;
    document.getElementById('countSingle').textContent = singleCount;
    document.getElementById('countMulti').textContent = multiCount;
}

// 검색 결과 없음 메시지 업데이트
function updateNoResultsMessage(visibleCount, searchTerm) {
    const tbody = document.getElementById('sbomsTableBody');
    const noDataRow = document.getElementById('noDataRow');
    let noResultsRow = document.getElementById('noResultsRow');
    
    if (visibleCount === 0 && allSBOMs.length > 0) {
        if (!noResultsRow) {
            noResultsRow = document.createElement('tr');
            noResultsRow.id = 'noResultsRow';
            noResultsRow.innerHTML = `
                <td colspan="7" class="text-center text-muted py-4">
                    <i class="bi bi-search display-4 d-block mb-3"></i>
                    <span id="noResultsText">검색 결과가 없습니다.</span>
                    <br><br>
                    <button class="btn btn-outline-secondary mt-2" onclick="clearSearch()">
                        <i class="bi bi-arrow-clockwise"></i>
                        검색 초기화
                    </button>
                </td>
            `;
            tbody.appendChild(noResultsRow);
        }
        
        const message = searchTerm ? 
            `"${searchTerm}"에 대한 검색 결과가 없습니다.` : 
            '선택한 필터에 해당하는 SBOM이 없습니다.';
        document.getElementById('noResultsText').textContent = message;
        noResultsRow.style.display = '';
        
        if (noDataRow) noDataRow.style.display = 'none';
    } else {
        if (noResultsRow) noResultsRow.style.display = 'none';
        if (noDataRow && allSBOMs.length === 0) noDataRow.style.display = '';
    }
}

// SBOM 페이지네이션 적용
function applySBOMPagination() {
    // 모든 행 숨기기
    allSBOMs.forEach(sbom => {
        sbom.element.style.display = 'none';
    });
    
    // 페이지네이션 계산
    const totalItems = filteredSBOMs.length;
    const totalPages = Math.ceil(totalItems / pageSize);
    const startIndex = (currentPage - 1) * pageSize;
    const endIndex = Math.min(startIndex + pageSize, totalItems);
    
    // 현재 페이지가 총 페이지 수를 초과하는 경우 첫 페이지로 이동
    if (currentPage > totalPages && totalPages > 0) {
        currentPage = 1;
        applySBOMPagination();
        return;
    }
    
    // 현재 페이지의 항목들만 표시
    for (let i = startIndex; i < endIndex; i++) {
        if (filteredSBOMs[i]) {
            filteredSBOMs[i].element.style.display = '';
        }
    }
    
    // 페이지네이션 UI 업데이트
    updateSBOMPagination(totalItems, currentPage, totalPages);
}

// SBOM 페이지네이션 UI 업데이트
function updateSBOMPagination(totalItems, currentPageNum, totalPages) {
    const pageInfo = document.getElementById('sbomPageInfo');
    const pagination = document.getElementById('sbomPagination');
    
    if (totalItems === 0) {
        pageInfo.textContent = '항목이 없습니다';
        pagination.innerHTML = '';
        return;
    }
    
    const startItem = (currentPageNum - 1) * pageSize + 1;
    const endItem = Math.min(currentPageNum * pageSize, totalItems);
    pageInfo.textContent = `${startItem}-${endItem} / ${totalItems}개 항목`;
    
    if (totalPages <= 1) {
        pagination.innerHTML = '';
        return;
    }
    
    let paginationHTML = '';
    
    // 이전 페이지 버튼
    paginationHTML += `
        <li class="page-item ${currentPageNum === 1 ? 'disabled' : ''}">
            <a class="page-link" href="#" onclick="goToSBOMPage(${currentPageNum - 1}); return false;">
                <i class="bi bi-chevron-left"></i>
            </a>
        </li>
    `;
    
    // 페이지 번호들
    const startPage = Math.max(1, currentPageNum - 2);
    const endPage = Math.min(totalPages, currentPageNum + 2);
    
    if (startPage > 1) {
        paginationHTML += `
            <li class="page-item">
                <a class="page-link" href="#" onclick="goToSBOMPage(1); return false;">1</a>
            </li>
        `;
        if (startPage > 2) {
            paginationHTML += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
        }
    }
    
    for (let i = startPage; i <= endPage; i++) {
        paginationHTML += `
            <li class="page-item ${i === currentPageNum ? 'active' : ''}">
                <a class="page-link" href="#" onclick="goToSBOMPage(${i}); return false;">${i}</a>
            </li>
        `;
    }
    
    if (endPage < totalPages) {
        if (endPage < totalPages - 1) {
            paginationHTML += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
        }
        paginationHTML += `
            <li class="page-item">
                <a class="page-link" href="#" onclick="goToSBOMPage(${totalPages}); return false;">${totalPages}</a>
            </li>
        `;
    }
    
    // 다음 페이지 버튼
    paginationHTML += `
        <li class="page-item ${currentPageNum === totalPages ? 'disabled' : ''}">
            <a class="page-link" href="#" onclick="goToSBOMPage(${currentPageNum + 1}); return false;">
                <i class="bi bi-chevron-right"></i>
            </a>
        </li>
    `;
    
    pagination.innerHTML = paginationHTML;
}

// SBOM 페이지 이동
function goToSBOMPage(page) {
    const totalPages = Math.ceil(filteredSBOMs.length / pageSize);
    if (page < 1 || page > totalPages) return;
    
    currentPage = page;
    applySBOMPagination();
}

// SBOM 페이지 크기 변경
function changeSBOMPageSize() {
    pageSize = parseInt(document.getElementById('sbomPageSize').value);
    currentPage = 1;
    applySBOMPagination();
}
</script>
{{end}} 